<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta content="耘存科技" http-equiv="keywords">
	<meta name="description" content="耘存科技">
	<meta name="viewport" content="width=device-width,user-scalable=no, initial-scale=1">
	<title>音频检索</title>
	<!-- css -->
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/children.css">
	<link rel="stylesheet" type="text/css" href="css/swiper.min.css">
	<link rel="stylesheet" type="text/css" href="css/search.css">
	<!-- js -->
	<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="js/swiper.min.js"></script>
	<!-- <script type="text/javascript" src="js/public.js"></script> -->
	<!--简单弹出框-->
	<script type="text/javascript" src="./js/static/message.js"></script>
	<style>
		.hot_wrap {
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.hot_box {
			width: 80%;
			line-height: 30px;
			font-size: 14px;
			color: #333;
		}

		.tu {
			position: relative;
			width: 100%;
			min-height: 42px;
			margin-top: 10%;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.tu .upLoad_btn {
			width: 80%;
			height: 40px;
			background: linear-gradient(45deg, #0083c3, #f2fcfe);
			display: flex;
			justify-content: center;
			align-items: center;
			color: #fff;
			font-size: 16px;
			border-radius: 30px;
			margin-top: 40px;
			letter-spacing: 2px;
			box-shadow: 0 5px 6px rgba(10, 16, 20, .24), 0 0 3px rgba(10, 16, 20, .12);
		}
		/*
		.tu input {
			position: absolute;
			top: 20px;
			left: 39px;
			width: 80%;
			height: 40px;
			opacity: 0;
		}
		*/

		.tus {
			width: 80%;
			margin: 20px auto;
		}

		.downLoad_btn_wrap {
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 20px;
		}

		.btn {
			margin-top: 20px;
			width: 80%;
			height: 40px;
			/*margin-left: 11%;*/
			border-radius: 30px;
			background: linear-gradient(45deg, #0083c3, #f2fcfe);
			color: #fff;
			font-size: 16px;
			letter-spacing: 2px;
			box-shadow: 0 5px 6px rgba(10, 16, 20, .24), 0 0 3px rgba(10, 16, 20, .12);
		}

		.audio_wrap {
			width: 100%;
		}

		.music_item {
			position: relative;
			width: 80%;
			line-height: 30px;
			margin: 15px auto;
			background: linear-gradient(45deg, #0083c3, #f2fcfe);
			display: flex;
			justify-content: space-between;
			padding: 0 10px;
			box-sizing: border-box;
			border-radius: 10px;
			box-shadow: 0 2px 2px rgba(10, 16, 20, .24), 0 0 2px rgba(10, 16, 20, .12);
		}

		.music_item .music_date {
			position: absolute;
			right: 60px;
		}

		.field {
			border: 0;
			width: 100%;
			height: 100%;
			padding: 10px 20px;
			background: white;
			border-radius: 3px;
			box-shadow: 0px 8px 15px rgba(75, 72, 72, 0.1);
		}

		#tip { /* 勿删  配合简单提示框用的样式 */
			display: inline-block;
			min-width: 200px;
			height: 40px;
			text-align: center;
			line-height: 40px;
			color: #fff;
			font-size: 14px;
			border-radius: 5px;
		}

		.btn-audio {
			width: 30px;
			height: 30px;
			background: url("./images/static/play.png") no-repeat center bottom;
			background-size: cover;
		}

		.mask_wrap {
			width: 100%;
			height: 100%;
			position: fixed;
			top: 0;
			left: 0;
			background: #000;
			filter: alpha(Opacity=60);
			-moz-opacity: 0.6;
			opacity: 0.6;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.loader {
			margin: 0 0 2em;
			height: 100px;
			width: 20%;
			text-align: center;
			padding: 1em;
			margin: 0 auto 1em;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}

		svg path,
		svg rect {
			/*fill: #FF6700;*/
			fill: #0083c3;
		}

		.upLoad_form {
			display: flex;
			flex-direction: column;
			width: 80%;
		}
		.upLoad_form input {
			border: 1px solid #ccc;
			margin-bottom: 10px;
			height: 30px;
		}
		.upLoad_form .btn_ipt {
			border: none;
		}
		.upLoad_form .upLoad_ipt {
			position: absolute;
			top: 50px;
			left: 0;
			width: 100%;
			opacity: 0;
		}
		.upLoad_form .btn {
			width: 100%;
			height: 40px;
		}
		.fileName_box {
			width: 100%;
			line-height: 30px;
		}
		.music_wrap audio {
			width: 100%;
			height: 50px;
		}
	</style>
</head>
<body style="position: relative">
<div class="top_bg">
	<div class="top_main fix">
		<div class="top_logo">
			<a href="index.html"><img src="images/yclogo.png" /></a>
		</div>
		<!--
        <div class="top_search">
            <a href="search.html"><span></span></a>
        </div>
        -->
	</div>
</div>
<!-- contentbox -->
<div class="contentbox" style="background: #f5f5f5">
	<!--  style="background: #f5f5f5" -->
	<!--顶部背景图-->
	<div class="zy_banner">
		<!-- 子页banner尺寸640x240 -->
		<img src="images/bgimg3.png">
	</div>
	<!-- 中间内容开始 -->
	<div class="zy_content padding_03">
		<div class="search_box tus">
			<input type="text" class="searchTerm search_fileName_ipt" placeholder="文件名" style="color: #333;margin-right: 2px;">
			<input type="text" class="searchTerm search_fileType_ipt" placeholder="文件类型例如mp3/mp4" style="color: #333;border-right : none;">
			<button type="submit" class="searchButton">
				<img src="./images/search.png" alt="">
			</button>
		</div>
		<div class="hot_wrap">
			<div class="hot_box">
				<span>热门检索 :</span>
			</div>
		</div>
		<div class="audio_wrap">
			<div class="music_item">

				<!-- <span>音乐1</span><span class="music_date">03:26</span><span class="music_play">播放</span>-->
				<span>音乐1</span><span class="music_date">03:26</span><span class="music_play btn-audio"><audio
					class="mp3Btn" src="./audio/如果当时.mp3"></audio></span>
				<!--
                <audio src="./audio/如果当时.mp3" controls></audio>
                -->
			</div>
			<div class="music_item">

				<!-- <span>音乐2</span><span class="music_date">03:26</span><span class="music_play">播放</span>-->
				<span>音乐2</span><span class="music_date">03:26</span><span class="music_play btn-audio"><audio
					class="mp3Btn" src="./audio/如果当时.mp3"></audio></span>
				<!--
                <audio src="./audio/如果当时.mp3" controls></audio>
                -->
			</div>
			<div class="music_item">

				<!-- <span>音乐3</span><span class="music_date">03:26</span><span class="music_play">播放</span>-->
				<span>音乐3</span><span class="music_date">03:26</span><span class="music_play btn-audio"><audio
					class="mp3Btn" src="./audio/如果当时.mp3"></audio></span>
				<!--
                <audio src="./audio/如果当时.mp3" controls></audio>
                -->
			</div>
		</div>
		<div style="margin-top: 50px">

			<div class="tu">
				<!--
                <div class="upLoad_btn">
                    上传音乐
                    <input id="upLoadFileIpt" type="file" accept="audio/*" alt="">
                </div>
                -->
				<form class="upLoad_form" action="http://61.147.123.84:9000/v2/addMusic", method="post" enctype="multipart/form-data"> <!--  target="target" -->
					<!--
                    <input class="fileName_ipt" type="text" value="aaaaa" name="name"/>
                    <input class="userName_ipt" type="text" value="yst" name="username"/>
                    -->
					<input class="fileName_ipt" type="text" name="name" placeholder="输入文件名称" style="padding-left: 10px" autocomplete="off" oninput='this.value=this.value.replace(" ", "");'/>
					<!-- <input class="userName_ipt" type="text" name="username" placeholder="输入用户名" style="padding-left: 10px" autocomplete="off" /> -->
					<div style="position: relative">
						<div class="fileName_box"><span>选择的文件 : </span><span class="upLoad_fileName"></span></div>
						<button class="btn">选择文件</button>
						<input class="upLoad_ipt" id="upLoadFileIpt" type="file" name="upload" style="height: 40px" />
					</div>
					<!-- <input class="btn_ipt btn" type="submit" value="确认上传" /> -->
					<input class="btn_ipt btn" type="button" value="确认上传" />
				</form>
				<!-- <iframe name="target" id="target" style="display: none"></iframe> -->
			</div>
			<div class="downLoad_btn_wrap">
				<button class="btn">下载</button>
			</div>
		</div>
	</div>
	<!-- 中间内容结束 -->
</div>

<!-- slide侧边栏 -->
<div class="side_bar">
	<span class="btn_top"></span>
</div>

<!-- footer -->
<div class="footbox">
	<h2>
		<a href="about_item.html">公司项目</a>丨<a href="contact.html">联系我们</a>
	</h2>
	<div class="txt">
		<p>CopyRight © 上海耘存科技发展有限公司</p>
		<p>联系地址: 上海市静安区平型关路108创意广场品座37号5楼</p>
	</div>
</div>
<!-- 底部菜单 -->
<div class="menubox">
	<ul class="fix">
		<li>
			<a href="index.html">
				<i>
					<img src="images/menu_icon01.png" alt="首页" />
					<img src="images/menu_icon01_1.png" alt="首页" />
				</i>
				<span>首页</span>
			</a>
		</li>
		<li>
			<a href="video.html">
				<i>
					<img src="images/menu_icon02.png" alt="音频中心" />
					<img src="images/menu_icon02_1.png" alt="音频中心" />
				</i>
				<span>音频中心</span>
			</a>
		</li>
		<li>
			<a href="search.html">
				<i>
					<img src="images/icon_search2.png" alt="搜索" />
					<img src="images/icon_search2.png" alt="搜索" />
				</i>
				<span>搜索</span>
			</a>
		</li>
		<li class="menubtn">
			<i>
				<img src="images/menu_icon04.png" alt="菜单" />
				<img src="images/menu_icon04_1.png" alt="菜单" />
			</i>
			<span>菜单</span>
		</li>
	</ul>
	<!-- 菜单导航 -->
	<span class="menu_panel"></span>
	<!--
    <dl class="menu">
        <dd><a href="login.html">登录</a></dd>
        <dd><a href="register.html">注册</a></dd>
        <dd><a href="video.html">音频中心</a></dd>
        <dd><a href="about.html">关于我们</a></dd>
        <dd><a href="contact.html">联系我们</a></dd>
    </dl>
    -->
</div>

<!-- loading提示框 -->
<div class="mask_wrap" style="display: none">
	<div class="loader loader--style2" title="1">
		<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg"
			 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px"
			 viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
				<path fill="#000"
					  d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z">
					<animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25"
									  to="360 25 25" dur="0.6s" repeatCount="indefinite" />
				</path>
		</svg>
		<!-- 上传的进度 (百分比) -->
		<div id="progressNumber" style="width: 50px;line-height: 30px;color: #fff"></div>
	</div>
</div>



<script>
	$(function () {
		// 获取本地存储的 isLogin 来验证当前用户是否登录了 (如果能获取到, 则说明登录了)
		let isLogin = localStorage.getItem("isLogin")
		// 获取本地存储的 isAdminLogin 来验证当前管理员是否登录了 (如果能获取到, 则说明登录了)
		let isAdminLogin = localStorage.getItem("isAdminLogin")
		// 获取本地存储的 当前用户登录的用户名
		let localUserName = localStorage.getItem('userName')
		/**
		 * 音乐上传
		 */
		// var oUploadImg = document.querySelector("#uploadImg") // 获取uploaImg节点,
		var oFile = document.querySelector("#upLoadFileIpt"); // 获取input file节点
		var file = ''
		var fileType = ''
		oFile.addEventListener('change', function () {
			if (isLogin || isAdminLogin) { // 已登录 (允许上传)
				file = this.files[0];
				fileType = file.name.split('.')[1]
				$('.upLoad_fileName').html(file.name)
				/*
				if (file.name.indexOf("mp3") != -1) { // 说明上传的是 mp3后缀的音频
                    // var val
                    // var formData = new FormData();
					// formData.append('file', file)
                    // console.log(2222222222, formData.get('file'));
                    $.ajax({
                        type: "",
                        url: '',
                        data: {},
                        dataType: 'json',
                        beforeSend: function () {
                            // 显示loading提示
                            $('.mask_wrap').show()
                        },
                        success: function (result) {
                            // 关闭loading提示
                            $('.mask_wrap').hide()
                            console.log(result);
                        },
                        error: function () {
                            // 关闭loading提示
                            $('.mask_wrap').hide()
                            // ShowFailure('上传失败, 请稍后再试 !')
                        }
                    })
					let maxSize = 15
					if (file.size / 1024 / 1024 >= maxSize) { // 允许上传
					} else { // 不允许上传
						ShowFailure('上传的文件不能小于 15M!')
					}
				} else {
					ShowFailure('请上传mp3格式的文件!')
				}
				*/
				/*
				let maxSize = 15
				if (file.name.indexOf("mp3") == -1) {
					ShowFailure('请上传mp3格式的文件!')
					$('.btn_ipt').hide()
					return false
				} else if (file.size / 1024 / 1024 < maxSize) {
					ShowFailure("上传的文件不能小于 15M !")
					$('.btn_ipt').hide()
					return false
				} else { $('.btn_ipt').show() }
				if ($('.fileName_ipt').val() == '') {
					ShowFailure("音乐名不能为空 !")
					$('.btn_ipt').hide()
					return false
				} else if ($('.userName_ipt').val() == '') {
					ShowFailure("用户名不能为空 !")
					$('.btn_ipt').hide()
					return false
				} else { $('.btn_ipt').show() }
				*/
				/*
				else {
					console.log('+++++++++++', file);
					let fileName = file.name.split('.')[0]
					console.log('::::--------', fileName);
					console.log('::::--------', localUserName);
					$('.fileName_ipt').val(fileName)
					$('.userName_ipt').val(localUserName)
				}
				*/
			} else { // 未登录 (不允许上传)
				ShowFailure('请先登录 ~')
				setTimeout(() => {
					window.location.href = './login.html'
				})
			}
		})
		$('.btn_ipt').on('click', function () {
			/*
			$('#target').load(function () {
				console.log('++++++======', $(this));
				$('.mask_wrap').hide()
			})
			*/
			if (file != '') {
				console.log('llalala==========', file);
				let maxSize = 50
				let maxSize2 = 200
				if (file.name.indexOf("mp3") == -1 && file.name.indexOf("mp4") == -1) {
					ShowFailure('请上传mp3或者mp4格式的文件 !')
					return false
				} else if (file.size / 1024 / 1024 < maxSize) {
					ShowFailure("上传的文件不能小于 50M !")
					return false
				} else if (file.size / 1024 / 1024 > maxSize2) {
					ShowFailure("上传的文件不能大于 200M !")
					return false
				}
				if ($('.fileName_ipt').val() == '') {
					ShowFailure("音乐名不能为空 !")
					return false
				}
				/*
				else if ($('.userName_ipt').val() == '') {
					ShowFailure("用户名不能为空 !")
					return false
				}
				*/
				$('.mask_wrap').show()
				// 开始上传文件
				uploadFile()
			} else {
				ShowFailure("请选择上传的文件 !")
				return false
			}
		})
		function uploadFile() {
			var fd = new FormData();
			fd.append('name', $('.fileName_ipt').val())
			fd.append('username', localUserName)
			fd.append('type', fileType)
			fd.append("upload", document.getElementById('upLoadFileIpt').files[0]);
			console.log('::::::::::---------', fd.get('name'));
			console.log('::::::::::---------', fd.get('username'));
			console.log('::::::::::---------', fd.get('type'));
			console.log('::::::::::---------', fd.get('upload'));
			return
			var xhr = new XMLHttpRequest();
			// 监听服务器的响应
			xhr.addEventListener("load", uploadComplete, false);
			xhr.open("POST", "http://61.147.123.84:9000/v2/addMusic");
			xhr.send(fd);
		}
		function uploadComplete(evt) {
			/* 当服务器响应后，这个事件就会被触发 */
			console.log('服务器响应了++++++++++', evt.target.responseText)
			ShowSuccess(evt.target.responseText)
			$('.fileName_ipt').val('')
			$('.userName_ipt').val('')
			$('.upLoad_fileName').html('')
			$('.mask_wrap').hide()
		}


		/**
		 * 获取音乐列表
		 */
		function getMusicList() {
			/*
            $.ajax({
                type: "",
                url: '',
                data: {},
                dataType: 'json',
                success: function (result) {
                    console.log(result);

                },
                error: function () {
                    ShowFailure('网络错误, 请稍后再试 !')
                }
            })
            */
			let mp3DataList = ['./audio/如果当时.mp3', './audio/如果当时.mp3', './audio/如果当时.mp3', './audio/如果当时.mp3']
			let html = ''
			mp3DataList.forEach((item, index) => {
				var audioElement = new Audio(item); // audio也可获取视频的时长
				var duration
				audioElement.addEventListener("loadedmetadata", function (_event) {
					duration = audioElement.duration;
					// 分钟
					var minute = parseInt(duration / 60);
					// 秒
					var second = Math.round(duration % 60);
					html += `
									<div class="music_item">
										<span>如果当时</span><span class="music_date">${minute}:${second}</span><span class="music_play btn-audio"><audio class="mp3Btn" src="${item}"></audio></span>
									</div>
								`
					$('.audio_wrap').html(html)
				})
			})
		}
		getMusicList()


		/**
		 * 控制音乐播放和暂停
		 */
		var timer = ''
		let cur = ''
		let temp = ''
		let minute = ''
		$('.audio_wrap').on('click', '.music_item .btn-audio', function () {
			event.stopPropagation(); // 防止冒泡
			let audio = $(this).find('audio')[0]
			let $this = $(this)
			console.log(audio);
			if (audio.paused) { // 如果当前是暂停状态
				$(this).css({ 'background': 'url(./images/static/pause.png) no-repeat center bottom', 'background-size': 'cover' });
				timer = setInterval(function () {
					cur = String(audio.currentTime).split('.')[0]
					temp = cur
					minute = parseInt(temp / 60);
					if (cur % 60 < 10) {
						$(audio).parent('.btn-audio').prev().html("" + minute + ":0" + cur % 60 + "")
					} else {
						$(audio).parent('.btn-audio').prev().html("" + minute + ":" + cur % 60 + "")
					}
				}, 1000)
				audio.play(); // 播放
				// 当前音乐如果在播放中, 再点击播放其它音乐时, 就把当前正在播放的音乐暂停, 播放按钮变成 play 状态, 然后播放其它的点击播放的音乐
				$this.parent().siblings('.music_item').find('.mp3Btn').each(function () {
					$(this)[0].pause()
					$(this).parent().css({ 'background': 'url(./images/static/play.png) no-repeat center bottom', 'background-size': 'cover' });
				})
				// 播放完毕
				$(this).children('.mp3Btn').on('ended', function () {
					console.log("音频已播放完成");
					$(this).parent().css({ 'background': 'url(./images/static/play.png) no-repeat center bottom', 'background-size': 'cover' });
				})
				return;
			} else { // 当前是播放状态
				$(this).css({ 'background': 'url(./images/static/play.png) no-repeat center bottom', 'background-size': 'cover' });
				clearInterval(timer)
				audio.pause(); // 暂停
			}
		})

		/**
		 * 搜索
		 */
		$('.searchButton').on('click', function () {
			let name = $('.search_fileName_ipt').val()
			let type = $('.search_fileType_ipt').val()
			console.log('::::::::', name == '');
			console.log('::::::::', type == '');
			if (name == '') {
				ShowFailure('文件名不能为空 !')
				return false
			} else if (type == '') {
				ShowFailure('文件类型不能为空 !')
				return false
			} else if (type != 'mp3' && type != 'mp4') {
				ShowFailure('文件类型必须是 mp3 或者 mp4 !')
				return false
			} else {
				$('.mask_wrap').show()
				$('#progressNumber').html('搜索中 ...')
				if (type == 'mp3') {
					//$('.music_wrap').html(`<audio src="http://61.147.123.84:9000/v2/searchMusic?name=${name}" controls></audio>`)
					var audioElement = new Audio(`http://61.147.123.84:9000/v2/searchMusic?name=${name}&type=${type}`); // audio也可获取视频的时长
					setTimeout(() => {
						if ($('.mask_wrap').css('display') == 'flex') {
							ShowFailure("未搜索到此文件 !")
							$('.mask_wrap').hide()
							$('.search_fileName_ipt').val('')
							$('.search_fileType_ipt').val('')
						}
					}, 15000)
					var duration
					audioElement.addEventListener("loadedmetadata", function (_event) {
						duration = audioElement.duration;
						// 分钟
						var minute = parseInt(duration / 60);
						// 秒
						var second = Math.round(duration % 60);
						let html = `
									<div class="music_item">
										<span>${name}</span><span class="music_date">${minute}:${second}</span><span class="music_play btn-audio"><audio class="mp3Btn" src="http://61.147.123.84:9000/v2/searchMusic?name=${name}&type=${type}"></audio></span>
									</div>
									`
						$('.mask_wrap').hide()
						$('.audio_wrap').html(html)
						$('.search_fileName_ipt').val('')
						$('.search_fileType_ipt').val('')
					})

				} else if (type == 'mp4') {
					var audioElement = new Audio(`http://61.147.123.84:9000/v2/searchMusic?name=${name}&type=${type}`); // audio也可获取视频的时长
					setTimeout(() => {
						if ($('.mask_wrap').css('display') == 'flex') {
							ShowFailure("未搜索到此文件 !")
							$('.mask_wrap').hide()
							$('.search_fileName_ipt').val('')
							$('.search_fileType_ipt').val('')
						}
					}, 15000)
					audioElement.addEventListener("loadedmetadata", function (_event) {
						let html = `
									<div style="width: 100%;display: flex;justify-content: center">
										<video class="" style="width: 300px;height: 200px" controls src="http://61.147.123.84:9000/v2/searchMusic?name=${name}&type=${type}"></video>
									</div>
									`
						$('.mask_wrap').hide()
						$('.audio_wrap').html(html)
						$('.search_fileName_ipt').val('')
						$('.search_fileType_ipt').val('')
					})
				}
			}


			/*
			//$('.music_wrap').html(`<audio src="http://61.147.123.84:9000/v2/searchMusic?name=${name}" controls></audio>`)

			var audioElement = new Audio(`http://61.147.123.84:9000/v2/searchMusic?name=${name}`); // audio也可获取视频的时长
			console.log('lalal=====', audioElement);
			var duration
			audioElement.addEventListener("loadedmetadata", function (_event) {
				duration = audioElement.duration;
				// 分钟
				var minute = parseInt(duration / 60);
				// 秒
				var second = Math.round(duration % 60);
				let html = `
									<div class="music_item">
										<span>${name}</span><span class="music_date">${minute}:${second}</span><span class="music_play btn-audio"><audio class="mp3Btn" src="http://61.147.123.84:9000/v2/searchMusic?name=${name}"></audio></span>
									</div>
								`
				$('.audio_wrap').html(html)
				$('.search_fileName_ipt').val('')
				$('.search_fileType_ipt').val('')
			})
			*/

			/*
			$.ajax({
				type: "get",
				url: `http://61.147.123.84:9000/v2/searchMusic`,
				data: {name},
				dataType: 'json',
				success: function (result) {
					console.log('======:::::::::', result);
				},
				error: function () {
					ShowFailure('网络错误, 请稍后再试 !')
				}
			})
			*/
		})
	})
</script>
<script>
	$(function () {
		$('.menu_panel').load('./common/menu.html')
	})
</script>
</body>

</html>