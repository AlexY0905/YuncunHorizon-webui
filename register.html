<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta content="耘存科技" http-equiv="keywords">
	<meta name="description" content="耘存科技">
	<meta name="viewport" content="width=device-width,user-scalable=no, initial-scale=1">

	<!-- favicons -->
	<link rel="apple-touch-icon" href="./images/favicon-apple.png">
	<link rel="icon" href="">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="http://cdn.bootstrapmb.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<!-- Material design icons CSS -->
	<link rel="stylesheet" href="./css/static/material-icons.css">
	<!-- aniamte CSS -->
	<link rel="stylesheet" href="./css/static/animate.css">
	<!-- swiper slider CSS -->
	<!-- <link rel="stylesheet" href="/static/vendor/swiper/css/swiper.min.css"> -->
	<!-- app CSS -->
	<link id="theme" rel="stylesheet" href="./css/static/purplesidebar.css" type="text/css">
	<!-- icon -->
	<link rel="stylesheet" href="./css/static/demo.css">
	<link rel="stylesheet" href="./css/static/iconfont.css">
	<title>用户注册</title>

	<style>
		body {
			background-image: url("./images/block3.jpg");
			background-size: 100% 200%;
		}

		ul,
		li {
			list-style: none;
		}

		.login {
			width: 100%;
		}

		.login .on_changes {
			width: 100%;
			position: absolute;
			top: 125px;
			list-style: none;
			background: #FFF;
			display: none;
			z-index: 99999;
			margin: 20px auto;
		}

		.login .on_changes li {
			margin: 8px;
			padding: 4px;
			margin-left: -30px;
		}

		.login .on_changes li.active {
			background: #CEE7FF;
		}

		.card {
			background-color: transparent;
		}

		.form-control {
			width: 80%;
			display: block;
			margin: 6px auto;
			border-radius: inherit;
		}

		.c-333 {
			margin-top: 4px;
		}

		input::-webkit-input-placeholder,
		textarea::-webkit-input-placeholder {
			color: #fff !important;
			font-size: 16px;
		}

		.line {
			border-top: 1px solid #424141;
			width: 70%;
			margin-top: 1px;
		}

		.btn1 {
			position: relative;
			display: inline-block;
			width: 100%;
			height: 100%;
			overflow: hidden;
			text-align: center;
			font-size: 18px;
			line-height: 130px;
			vertical-align: center;
			color: seashell;
			border-radius: 3px;
		}

		.btn1 input {
			position: absolute;
			left: 0;
			top: 0;
			opacity: 0;
		}

		.icon {
			width: 1em;
			height: 1em;
			vertical-align: -0.15em;
			fill: currentColor;
			overflow: hidden;
		}

		.ren {
			width: 1.1rem;
			position: absolute;
			top: 22px;
			left: -120px;
		}

		.mail {
			width: 1.1rem;
			position: absolute;
			top: 20px;
			left: -120px;
		}

		.mi {
			width: 1.1rem;
			position: absolute;
			top: 20px;
			left: -120px;
		}

		.mi2 {
			width: 1.1rem;
			position: absolute;
			top: 25px;
			left: -120px;
		}

		.phone {
			width: 1.1rem;
			position: absolute;
			top: 20px;
			left: -120px;
		}

		.code {
			width: 1.1rem;
			position: absolute;
			top: 20px;
			left: -120px;
		}

		.btncode {
			/* opacity: 0.8; */
			color: #fff;
			border: 1px solid #fff;
		}

		.jie {
			color: #fff;
		}
	</style>


</head>

<body class="fixed-header sidebar-right-close sidebar-left-close">
	<!-- page loader -->
	<div class="loader justify-content-center pink-gradient">
		<div class="align-self-center text-center">
			<div class="logo-img-loader">
				<img src="./images/static/loader-hole.png" alt="" class="logo-image">
				<img src="./images/static/loader-bg.png" alt="" class="logo-bg-image">
			</div>
			<h2 class="mt-3 font-weight-light">耘存<br><small>- 手机端 -</small></h2>
			<p class="mt-2 text-white"></p>
		</div>
	</div>

	<!--公共头部-->
	<div id="header" style="height: 6%;"></div>

	<div class="container h-100 h-sm-auto align-items-center">
		<div class="row align-items-center h-100 h-sm-auto">
			<div class="col-12 col-sm-8 col-md-6 col-lg-5 col-xl-4 mx-auto text-center">
				<h4 class="font-weight-light mb-4 text-white text-center">欢迎注册耘存科技</h4>
				<!--选择头像 开始-->
				<label class="btn1">
					<img id="imgLower" class="image-lower"
						style="position: absolute; width: 130px; height: 130px; border-radius: 50%;">
					<span>&nbsp;&nbsp;点击添加头像</span>
					<ul id="fileList">
					</ul>
					<input type="file" id="file" accept="image/gif,image/jpeg,image/jpg,image/png" />
				</label>
				<!--选择头像 结束-->
				<div class="card mb-4">
					<div class="card-body p-0">
						<!--图片提示-->
						<span id="image"></span>
						<!--用户名-->
						<label for="name" class="sr-only">用户名</label>
						<span style="position: relative;">
							<img src="./images/static/ren.png" alt="" class="ren">
						</span>
						<input type="name" id="name" oninput="preSql(this)" maxlength="15"
							onkeyup="this.value=this.value.replace(/[^A-Za-z0-9_\u4e00-\u9fa5]/g,'');Checkname1(this.value)"
							class="form-control text-center form-control-lg border-0" placeholder="用户名" required=""
							autofocus="" style=" background-color: transparent; color:#fff; font-family: MingLiU;" />
						<!-- <hr class="line" /> -->
						<span id="login_err"></span>
						<svg class="icon svg-icon" aria-hidden="true" id="aa" style="display: none;">
							<use xlink:href="" id="icon1"></use>
						</svg>
						<span id="ts"></span>
						<div id="xs" style="color:red"></div>
						<hr class="my-0">
						<!--邮箱-->
						<label for="inputEmail" class="sr-only">邮箱</label>
						<span style="position: relative;">
							<img src="./images/static/mail.png" alt="" class="mail">
						</span>
						<div class="login">
							<div>
								<input type="email" id="inputEmail" oninput="preSql(this)"
									onkeyup="this.value=this.value.replace(/[^a-z0-9_]/g,'');"
									onblur="CheckEmeil(this.value)"
									class="form-control text-center form-control-lg border-0" placeholder="邮箱"
									maxlength="18" required=""
									style=" background-color: transparent; color:#fff; font-family: MingLiU;">
								<!-- <hr class="line" /> -->
							</div>
							<ul class="on_changes" style="position: absolute;">
								<li email=""></li>
								<li email="@sina.com"></li>
								<li email="@163.com"></li>
								<li email="@qq.com"></li>
								<li email="@hotmail.com"></li>
								<li email="@126.com"></li>
								<li email="@gmail.com"></li>
								<li email="@yahoo.com"></li>
							</ul>
						</div>
						<svg class="icon svg-icon" aria-hidden="true" id="bb" style="display: none;">
							<use xlink:href="" id="icon2"></use>
						</svg>
						<span id="mail"></span>
						<hr class="my-0">
						<!--输入密码 开始-->
						<label for="inputPassword" class="sr-only">输入密码</label>
						<span style="position: relative;">
							<img src="./images/static/mi.png" alt="" class="mi">
						</span>
						<table border="0" cellpadding="0" cellspacing="0">
							<tr align="center">
								<td id="pwd_Weak" class="pwd pwd_c"> </td>
								<td id="pwd_Medium" class="pwd pwd_c pwd_f"></td>
								<td id="pwd_Strong" class="pwd pwd_c pwd_c_r"> </td>
							</tr>
						</table>
						<input type="password" id="inputPassword" oninput="preSql(this)" maxlength="16"
							onkeyup="this.value=this.value.replace(/[^A-Za-z0-9_!]/g,'');CheckQiang(this.value)"
							class="form-control text-center form-control-lg border-0" placeholder="输入密码(6~16位字符)"
							required="" style=" background-color: transparent; color:#fff; font-family: MingLiU;">
						<!-- <hr class="line" /> -->
						<hr class="my-0">
						<div style="width: 70%; margin: 0 auto;">
							<span>
								<svg class="icon svg-icon" aria-hidden="true" id="cc" style="display: none; ">
									<use xlink:href="" id="icon3"></use>
								</svg>
							</span>
							<span id="err_msgPsw" style="margin-bottom: 10px;"></span>
						</div>
						<!--输入密码 结束-->
						<!--再次输入密码 开始-->
						<label for="inputPassword2" class="sr-only">再次输入密码</label>
						<span style="position: relative;">
							<img src="./images/static/mi.png" alt="" class="mi2">
						</span>
						<input type="password" id="inputPassword2" oninput="preSql(this)"
							onkeyup="this.value=this.value.replace(/[^A-Za-z0-9_!]/g,'');CheckQiang1(this.value)"
							maxlength="16" class="form-control text-center form-control-lg border-0"
							placeholder="再次输入密码" required=""
							style=" background-color: transparent; color:#fff; font-family: MingLiU; margin-top: 10px;">
						<!-- <hr class="line" /> -->
						<hr class="my-0">
						<svg class="icon svg-icon" aria-hidden="true" id="dd" style="display: none;">
							<use xlink:href="" id="icon4"></use>
						</svg>
						<span id="password_2"></span>
						<!--再次输入密码 结束-->
						<!--输入手机号-->
						<div class="input">
							<span style="position: relative;">
								<img src="./images/static/phone.png" alt="" class="phone">
							</span>
							<input type="text" id="regPhone" oninput="preSql(this)"
								onkeyup="this.value=this.value.replace(/[^0-9]/g,'');CheckPhone(this.value)"
								class="form-control text-center form-control-lg border-0" placeholder="请输入有效的手机号"
								style=" background-color: transparent; color:#fff; font-family: MingLiU;">
							<!-- <hr class="line" /> -->
							<hr class="my-0">
							<svg class="icon svg-icon" aria-hidden="true" id="ee" style="display: none;">
								<use xlink:href="" id="icon5"></use>
							</svg>
							<span id="err_msgPhone"></span>
						</div>
						<div class="input">
							<span style="position: relative;">
								<img src="./images/static/code.png" alt="" class="code">
							</span>
							<input type="text" id="yanZM" oninput="preSql(this)"
								class="form-control text-center form-control-lg border-0" placeholder="请输入验证码"
								onkeyup="this.value=this.value.replace(/[^0-9]/g,'');"
								style=" background-color: transparent; color:#fff; font-family: MingLiU;">
							<!-- <hr class="line" /> -->
							<span id="msgYanZM"></span>
							<!--<span id="sendYzm" >免费获取验证码</span>-->
							<input type="button" class="btn btn-outline-primary c-333 text-c js-code btncode"
								value="获取验证码" id="sendYzm">
						</div>
						<!--输入验证码-->
						<!-- <input type="text" id="code_input" oninput="preSql(this)" placeholder="请输入验证码" class="form-control text-center form-control-lg border-0"/>
                        <span id="code_res"></span>
                        <div id="v_container" style="width: 200px;height: 50px; margin: 0 auto;"></div> -->

					</div>
				</div>
				<div class="my-4 row">
					<div class="col-12  text-center">
						<div class="custom-control custom-checkbox">
							<input type="checkbox" class="custom-control-input" id="customCheck111" name="isNumeric"
								checked>
							<!-- <label class="custom-control-label text-white" for="customCheck111">接受 <a
                                href="">我们的权力和条款</a>.</label> -->
							<label class="custom-control-label" for="customCheck111"> <span class="jie">接受</span> <a
									href="">我们的权力和条款</a></label>
						</div>
					</div>
				</div>
				<div class="text-center">
					<a class=" btn btn-primary pink-gradient" onclick="mr_verify()" value="注册" id="my_button"
						style="width: 80%; margin-bottom: 15px;">注册</a>
					<a href="./login.html" class="btn btn-primary pink-gradient" style="width: 80%;">登录</a>
				</div>
				<br>
			</div>
		</div>
	</div>
	<!-- content page ends -->
	</div>
	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="./js/static/jquery-3.2.1.min.js"></script>
	<script src="./js/static/popper.min.js"></script>
	<script src="http://cdn.bootstrapmb.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
	<!-- Cookie jquery file -->
	<script src="./js/static/jquery.cookie.js"></script>
	<!-- swiper slider jquery file -->
	<script src="./js/static/swiper.min.js"></script>
	<!-- Application main common jquery file -->
	<script src="./js/static/main.js"></script>
	<!-- page specific script -->
	<!-- 邮箱下拉提示 -->
	<script type="text/javascript" src="./js/static/inputmail.js"></script>
	<!-- 验证码 -->
	<script src="./js/static/verification_code.js"></script>
	<!-- icon图标 -->
	<script src="./js/static/iconfont.js"></script>
	<!--图形验证码-->
	<script src="./js/static/gVerify.js"></script>
	<!--简单弹出框-->
	<script src="./js/static/showTip.js"></script>
	<!-- 过滤器SQL -->
	<script src="./js/static/filterSQL.js"></script>
	<!-- 输入框验证 -->
	<script src="./js/static/input_validation.js"></script>
	<script>
		$(function () {
			$("#inputEmail").changeTips({
				divTip: ".on_changes"
			});
		})
		//正则表达式
		function length(str) {
			return str.replace(/(^\s*)|(\s*$)/g, "").length;
		}
		function CheckStr(str) {
			var regx = /['"#$%&\^*》>,."<《？，。！@#￥%……’”：=!~()（）{}:;|?、·`【】/；]/;
			rs = regx.exec(str);
			if (rs != null) {
				return false;
			}
			else {
				return true;
			}
		}

		//创建压缩base64
		var fileDom = document.getElementById("file");
		var MAX_SIZE = 500;
		var files = [];

		fileDom.addEventListener("change", function () {

			var fileImg = this.files;
			console.log(fileImg);
			for (var i = 0; i < fileImg.length; i++) {
				var file = fileImg[i];
				if (!/image\/\w+/.test(file.type)) {
					alert("请选择图片")
					return false;
				}
				var imgSize = file.size;
				if (imgSize > 1 * 1024 * 1024) {
					$("#image").html("*上传的图片的大于1M,请重新选择*");
					$("#image").css("color", "red");
					$(this).val('')
					return false;
				}
				var reader = new FileReader();
				//这里利用了闭包的特性，来保留文件名
				(function (x) {
					reader.onload = function (e) {
						var liNode = document.createElement("li");
						liNode.innerText = x;
						//document.getElementById("fileList").appendChild(liNode);
						//调用压缩文件的方法，具体实现逻辑见下面
						render(this.result, x);
					}
				})(file.name);
				//告诉文件读取工具类读取那个文件
				reader.readAsDataURL(file);
			}
		}, false);
		function render(src, name) {
			//创建Image对象
			var image = new Image();
			image.onload = function () {
				console.log(image.width, image.height);
				//通过固定的宽高比压缩
				//宽大于高的情况
				if (image.width > MAX_SIZE && image.width >= image.height) {
					image.height *= MAX_SIZE / image.width;
					image.width = MAX_SIZE;
				}
				//宽小于高的情况
				if (image.height > MAX_SIZE && image.height > image.width) {
					image.width *= MAX_SIZE / image.height;
					image.height = MAX_SIZE;
				}
				var canvas = document.createElement("canvas");
				//获取2d画布
				var ctx = canvas.getContext("2d");
				canvas.width = image.width;
				canvas.height = image.height;
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				//绘制图片
				ctx.drawImage(image, 0, 0, image.width, image.height);
				//生成base64码
				var blob = canvas.toDataURL("image/png");
				//console.log(blob)
				files.push(blob);
				document.getElementById("imgLower").src = blob;
			};
			image.src = src;
			//console.log("blob",blob);
		}

		function mr_verify() {
			//获取表单对象
			var chackbox = document.getElementById("customCheck111");
			var img = document.getElementById("file");

			if (img.value === '' || img.value === null) {//验证头像是否为空
				ShowFailure("请插入一张图片作为头像！")
				return;
			}
			//判断是否有勾选条约复选框
			if ($("#customCheck111").is(":checked") == false) {
				ShowMsg("请勾选 接受我们的权力和条款")
				return;
			}

			var data = files[0];
			var pos = data.indexOf("4") + 2;

			data = data.substring(pos, data.length - pos);
			// console.log("data",data)
			//将+号转码，防止传输过程中丢失
			data.replace(/\+/g, '%2B')
			//console.log("data",data);
			//用户名
			var name_input_1 = $('#name').val()
			//密码
			var pass_input_1 = $('#inputPassword').val()
			//再次输入密码
			var pass_input_2 = $('#inputPassword2').val()
			//获取输入的手机号
			var regPhone = document.getElementById("regPhone");
			//获取输入的验证码的 值
			var yanZM = $("#yanZM").val();
			//获取请求验证码的ajax并赋值
			var result_1 = result
			//邮箱
			var mail_1 = $('#inputEmail').val()
			var apos = mail_1.indexOf("@")
			var dotpos = mail_1.lastIndexOf(".")
			//验证邮箱是否为空
			// console.log("apos",apos)
			// console.log("dotpos",dotpos)
			// console.log("mail_1",mail_1)

			if (name_input_1.length >= 6 && pass_input_1.length > 5 && mail_1.length > 1) {
				if (apos < 1 || dotpos - apos < 3) {
					//验证邮件格式
					$("#mail").html("*您输入的邮箱格式有误,请重试*");
					$("#mail").css("color", "red");
					return;
				} else {
					if (CheckStr(name_input_1) == false) {
						$("#ts").html("*用户名存在特殊字符*");
						$("#ts").css("color", "red");
						return;
					} else {
						if (pass_input_1 === pass_input_2) {
							//判断校验码是否为空
							if (yanZM == null || yanZM == '') {
								$("#msgYanZM").html("验证码不能为空!");
								$("#msgYanZM").css("color", "red");
								return;
							} else if (yanZM == result_1) {//判断验证码是否一致
								//console.log("result_1",result_1)
								if (regPhone.value.length !== 11) {
									$("#err_msgPhone").html("*手机号是11个数字*");
									$("#err_msgPhone").css("color", "red");
									return;
								} else {
									$.ajax({
										type: "GET",
										url: "http://61.147.123.84:10080/user/user_regist",
										async: false,
										dataType: 'json',
										data: {
											name: $("#name").val(),
											mail: $("#inputEmail").val(),
											password: $("#inputPassword").val(),
											photo: data,
											tel: $("#regPhone").val()
										},
										success: function (data) {
											if (data.msg == "该用户名已经存在") {
												$("#xs").text("该用户名已经存在!");
												$("#xs").css("color", "red");
											} else if (data.msg == "该手机号已经注册") {
												ShowFailure("该手机号已经注册!")
												$("#regPhone").html("")
											} else {
												ShowSuccess("注册成功")
												// console.log("data", data)
												setInterval(() => {
													window.location.href = "./login.html";//注册之后跳转到登录
												}, 800)
											}
										}
									})
								}
							} else {
								$("#msgYanZM").html("验证码有误,请重试!");
								$("#msgYanZM").css("color", "red");
								return;
							}
						} else {
							$("#password_2").html("*密码设置前后不一致！*");
							$("#password_2").css("color", "red");
							return;
						}
					}//else
				}//else
			}//if
		}
		// 注册时，手机号 按正则格式输入 , 且检查已存在否
		$("#regPhone").focus(function () {
			$("#err_msgPhone").html("")
		})
		var result;
		$("#regPhone").blur(function () {
			var reg1 = /^1[3|4|5|7|8|9][0-9]\d{8}$/;
			if (!reg1.test(this.value)) {  //如果当前用户输入的值 非真（不符合手机号规则）
				ShowFailure("请输入正确的手机号！")
			} else if (reg1.test(this.value)) {
				//发送验证码  发起ajax请求,后台拦截这个请求
				$("#sendYzm").click(function () {
					var name = $("#name").val();
					var tel = $("#regPhone").val();
					// console.log(name);
					// console.log(tel);
					$.ajax({
						url: "http://61.147.123.84:10080/pool/send_verify_code",
						type: "GET",
						dataType: 'json',
						async: false,
						data: {
							name: name,
							tel: tel
						},
						success: function (data) {
							result = data
							// console.log(result)
						}
					})
				})
			}
		})

		'use strict';
		var mySwiper = new Swiper('.swiper-signin', {
			slidesPerView: 1,
			spaceBetween: 0,
			autoplay: true,
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			}
		});
	</script>
</body>

</html>